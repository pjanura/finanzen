<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ausgaben-Report â€“ Dezember 2025</title>

  <style>
    :root{
      --bg:#0b1020;
      --border: rgba(255,255,255,.10);
      --text:#e9ecf7;
      --muted: rgba(233,236,247,.7);
      --accent:#7c3aed;
      --shadow: 0 16px 40px rgba(0,0,0,.35);
      --radius: 18px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: var(--sans);
      color: var(--text);
      background:
        radial-gradient(1200px 600px at 15% -5%, rgba(124,58,237,.45), transparent 55%),
        radial-gradient(900px 500px at 85% 0%, rgba(59,130,246,.25), transparent 55%),
        radial-gradient(1200px 900px at 50% 120%, rgba(16,185,129,.18), transparent 60%),
        linear-gradient(180deg, #070a14, var(--bg));
      min-height:100vh;
    }
    .wrap{max-width:1180px;margin:0 auto;padding:28px 18px 42px}
    header{
      display:flex;flex-wrap:wrap;gap:14px;align-items:flex-end;justify-content:space-between;
      margin-bottom:18px;
    }
    .title{display:flex;flex-direction:column;gap:6px}
    h1{margin:0;font-size:28px;letter-spacing:.2px}
    .sub{color:var(--muted);font-size:13px;line-height:1.35}
    .badgeRow{display:flex;gap:10px;flex-wrap:wrap}
    .badge{
      padding:9px 12px;
      border:1px solid rgba(255,255,255,.12);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border-radius:999px;
      font-size:12px;
      color:var(--muted);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.08);
      backdrop-filter: blur(10px);
    }
    .badge strong{color:var(--text);font-weight:650}

    /* Layout */
    .grid{
      display:grid;
      grid-template-columns: 300px 1fr 0.6fr;
      gap:14px;
      align-items:start;
    }
    @media (max-width: 1200px){
      .grid{grid-template-columns: 280px 1fr 0.7fr}
    }
    @media (max-width: 930px){
      .grid{grid-template-columns: 1fr}
    }

    /* Premium glass cards */
    .card{
      border:1px solid rgba(255,255,255,.10);
      background:
        radial-gradient(1200px 600px at 10% 0%, rgba(255,255,255,.08), transparent 55%),
        linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.035));
      border-radius: var(--radius);
      box-shadow:
        0 18px 50px rgba(0,0,0,.45),
        inset 0 1px 0 rgba(255,255,255,.10);
      overflow:hidden;
      backdrop-filter: blur(10px);
    }
    .card h2{margin:0;font-size:14px;letter-spacing:.2px;color:rgba(233,236,247,.88)}
    .cardHead{
      padding:14px 16px;
      border-bottom:1px solid rgba(255,255,255,.10);
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
    }
    .cardBody{padding:16px 16px}

    /* Controls */
    .controls{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .search{
      flex:1;min-width:220px;
      display:flex;align-items:center;gap:8px;
      border:1px solid rgba(255,255,255,.12);
      border-radius:999px;
      background: rgba(0,0,0,.20);
      padding:8px 12px;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.06);
    }
    .search input{width:100%;background:transparent;border:0;outline:none;color:var(--text);font-size:13px}
    .pill{
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.03);
      color: var(--muted);
      padding:8px 10px;border-radius:999px;
      font-size:12px;display:flex;gap:8px;align-items:center;
      cursor:pointer; user-select:none;
      transition:.15s transform ease, .15s background ease;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.05);
    }
    .pill:hover{transform: translateY(-1px); background: rgba(255,255,255,.06);}
    .pill input{accent-color: var(--accent)}
    .btn{
      border:1px solid rgba(255,255,255,.12);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      color: var(--text);
      padding:9px 12px;border-radius:12px;
      cursor:pointer;
      transition:.15s transform ease, .15s background ease, .15s border-color ease;
      font-size:12px;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.08);
    }
    .btn:hover{
      transform: translateY(-1px);
      background: linear-gradient(180deg, rgba(255,255,255,.09), rgba(255,255,255,.04));
      border-color: rgba(255,255,255,.16);
    }
    .mini{color:var(--muted);font-size:12px}
    .hr{height:1px;background:rgba(255,255,255,.10);margin:12px 0}
    .foot{margin-top:14px;color:rgba(233,236,247,.55);font-size:12px;line-height:1.5}

    /* KPIs */
    .kpiRow{display:grid;grid-template-columns: repeat(3, minmax(0,1fr));gap:12px;margin-bottom:14px}
    @media (max-width:650px){.kpiRow{grid-template-columns:1fr}}
    .kpi{
      background:
        radial-gradient(700px 240px at 10% 0%, rgba(124,58,237,.10), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border: 1px solid rgba(255,255,255,.12);
      box-shadow:
        0 14px 30px rgba(0,0,0,.28),
        inset 0 1px 0 rgba(255,255,255,.10);
      border-radius: 16px;
      padding:14px 14px;
      overflow:hidden;
      min-width:0;
    }
    .kpi .label{
      color:rgba(233,236,247,.72);
      font-size:12px;
      letter-spacing:.2px;
      word-break:break-word;
      overflow-wrap:break-word;
      -webkit-hyphens:auto;
      hyphens:auto;
    }
    .kpi .value{
      font-size:22px;
      line-height:1.1;
      margin-top:6px;
      font-weight:800;
      word-break:break-word;
      overflow-wrap:break-word;
    }
    .kpi .hint{
      color:var(--muted);
      font-size:12px;
      margin-top:6px;
      word-break:break-word;
      overflow-wrap:break-word;
    }

    /* Basket */
    .basketCard{
      border:1px solid rgba(255,255,255,.12);
      background:
        radial-gradient(900px 420px at 20% 0%, rgba(59,130,246,.10), transparent 55%),
        linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border-radius:16px;
      overflow:hidden;
      box-shadow:
        0 18px 40px rgba(0,0,0,.35),
        inset 0 1px 0 rgba(255,255,255,.10);
    }
    .basketHead{
      padding:12px 12px;
      border-bottom:1px solid rgba(255,255,255,.10);
      display:flex;justify-content:space-between;gap:10px;align-items:center;
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
    }
    .basketTitle{display:flex;flex-direction:column;gap:1px}
    .basketTitle strong{font-size:13px;font-weight:700}
    .basketTitle span{font-size:11px;color:var(--muted)}
    .dropzone{
      padding:12px 12px 14px;
      min-height:140px;
      display:flex;flex-direction:column;gap:10px;
      border-top: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.10);
    }
    .dropzone.isOver{
      outline: 2px dashed rgba(124,58,237,.60);
      outline-offset: -10px;
      background: rgba(124,58,237,.10);
    }
    .dropHint{
      color:rgba(233,236,247,.7);
      font-size:12px;
      border:1px dashed rgba(255,255,255,.18);
      background: rgba(0,0,0,.12);
      border-radius:14px;
      padding:10px 10px;
    }
    .basketItem{
      display:flex;justify-content:space-between;gap:10px;align-items:flex-start;
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      border: 1px solid rgba(255,255,255,.12);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.08);
      border-radius: 14px;
      padding:10px 10px;
      overflow:hidden;
    }
    .basketItem > div:first-child{
      min-width:0;
      flex:1 1 auto;
      max-width:calc(100% - 120px);
      overflow:hidden;
    }
    .basketItem .name{
      color:rgba(233,236,247,.92);
      font-size:13px;
      line-height:1.35;
      font-weight:650;
      word-break:break-word;
      overflow-wrap:break-word;
      -webkit-hyphens:auto;
      hyphens:auto;
      max-width:100%;
    }
    .basketItem .meta{
      color:rgba(233,236,247,.60);
      font-size:12px;
      margin-top:2px;
      word-break:break-word;
      max-width:100%;
    }
    .basketItem .right{
      display:flex;
      gap:10px;
      align-items:flex-start;
      flex-shrink:0;
    }
    .basketItem .val{
      font-family:var(--mono);
      font-weight:850;
      white-space:nowrap;
    }
    .xbtn{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.05);
      color: rgba(233,236,247,.85);
      width:26px;height:26px;border-radius:10px;
      cursor:pointer;display:grid;place-items:center;flex:0 0 auto;
    }
    .xbtn:hover{background: rgba(255,255,255,.08)}
    .sumRow{
      padding:12px 12px;
      border-top:1px solid rgba(255,255,255,.10);
      display:flex;justify-content:space-between;align-items:center;gap:10px;
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
    }
    .sumRow .sum{font-size:18px;font-weight:900;font-family:var(--mono)}
    .sumRow .small{color:var(--muted);font-size:12px}

    /* Category list */
    .list{display:flex;flex-direction:column;gap:10px}
    .item{
      border:1px solid rgba(255,255,255,.11);
      border-radius:16px;
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.025));
      box-shadow: inset 0 1px 0 rgba(255,255,255,.07);
      overflow:hidden;
    }
    .itemTop{
      display:flex;
      gap:10px;
      align-items:flex-start;
      justify-content:space-between;
      padding:12px 12px;
      cursor:pointer;
      overflow:hidden;
    }
    .itemTop:hover{background: rgba(255,255,255,.05)}
    .itemName{
      display:flex;
      flex-direction:column;
      gap:3px;
      min-width:0;
      flex:1 1 auto;
      max-width:calc(100% - 100px);
      overflow:hidden;
    }
    .itemName .name{
      font-weight:700;
      overflow-wrap:break-word;
      word-wrap:break-word;
      word-break:break-word;
      hyphens:auto;
      -webkit-hyphens:auto;
      max-width:100%;
    }
    .itemName .meta{
      color:var(--muted);
      font-size:12px;
      overflow-wrap:break-word;
      word-wrap:break-word;
      word-break:break-word;
      max-width:100%;
    }
    .amount{
      font-family:var(--mono);
      font-weight:900;
      white-space:nowrap;
      margin-left:10px;
      flex-shrink:0;
      flex-grow:0;
      flex-basis:auto;
    }
    .bar{height:8px;border-radius:999px;background:rgba(255,255,255,.07);overflow:hidden;margin:0 12px 12px}
    .bar > div{height:100%;width:0%;border-radius:999px;background:linear-gradient(90deg, rgba(124,58,237,.95), rgba(59,130,246,.85), rgba(16,185,129,.85))}
    .details{
      display:none;
      border-top:1px solid rgba(255,255,255,.10);
      padding:10px 12px 12px;
      color: var(--muted);
      font-size:13px;
      line-height:1.45;
    }

    /* Draggable entries */
    .entryList{margin-top:10px;display:flex;flex-direction:column;gap:8px}
    .entry{
      display:flex;justify-content:space-between;gap:10px;align-items:flex-start;
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(0,0,0,.14));
      border: 1px solid rgba(255,255,255,.11);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.06);
      border-radius: 14px;
      padding:10px 10px;
      cursor:grab;
      user-select:none;
      overflow:hidden;
    }
    .entry:active{cursor:grabbing}
    .entry:hover{
      border-color: rgba(255,255,255,.16);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(0,0,0,.12));
    }
    .entry .left{
      display:flex;
      gap:10px;
      align-items:flex-start;
      min-width:0;
      flex:1 1 auto;
      max-width:calc(100% - 100px);
      overflow:hidden;
    }
    .handle{
      width:18px;height:18px;opacity:.8;flex:0 0 auto;
      display:grid;place-items:center;
      border:1px solid rgba(255,255,255,.16);
      border-radius:8px;
      background: rgba(255,255,255,.05);
      font-size:12px;
    }
    .entry .txt{
      min-width:0;
      flex:1 1 auto;
      max-width:100%;
      overflow:hidden;
    }
    .entry .label{
      color:rgba(233,236,247,.92);
      font-size:13px;
      line-height:1.35;
      word-break:break-word;
      overflow-wrap:break-word;
      -webkit-hyphens:auto;
      hyphens:auto;
      max-width:100%;
    }
    .entry .sub{
      color:rgba(233,236,247,.55);
      font-size:12px;
      margin-top:2px;
      max-width:100%;
    }
    .entry .val{
      font-family:var(--mono);
      font-weight:900;
      white-space:nowrap;
      flex-shrink:0;
      flex-grow:0;
      flex-basis:auto;
    }

    /* Right side */
    .rightStack{display:flex;flex-direction:column;gap:14px}
    canvas{width:100%;height:auto;display:block}
    .legend{display:flex;flex-wrap:wrap;gap:8px;margin-top:12px}
    .leg{
      display:flex;gap:8px;align-items:center;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.03);
      border-radius:999px;padding:7px 10px;font-size:12px;color:var(--muted);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.06);
    }
    .dot{width:10px;height:10px;border-radius:99px;background: rgba(255,255,255,.3)}

    .toast{
      position:fixed; left:50%; bottom:16px; transform:translateX(-50%);
      background: rgba(0,0,0,.6); border:1px solid rgba(255,255,255,.12);
      color: var(--text); padding:10px 12px; border-radius: 999px;
      font-size:12px; display:none;
      backdrop-filter: blur(10px);
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="title">
        <h1>Ausgaben-Report â€“ Dezember 2025</h1>
      </div>
      <div class="badgeRow" id="badgeRow"></div>
    </header>

    <div class="grid">
      <!-- LEFT: Basket (separate column) -->
      <aside style="position:sticky;top:28px;align-self:start">
        <div class="basketCard">
          <div class="basketHead">
            <div class="basketTitle">
              <strong>ðŸ§² Sammelkorb</strong>
              <span style="font-size:11px">Drag & Drop</span>
            </div>
            <div style="display:flex;gap:6px;align-items:center;flex-wrap:wrap">
              <button class="btn" id="copyBasket" style="padding:7px 10px;font-size:11px">Kopieren</button>
              <button class="btn" id="clearBasket" style="padding:7px 10px;font-size:11px">Leeren</button>
            </div>
          </div>

          <div class="dropzone" id="dropzone">
            <div class="dropHint" id="dropHint">
              Zieh Posten hier rein
            </div>
            <div id="bucketList"></div>
          </div>

          <div class="sumRow">
            <div>
              <div class="small">Summe</div>
              <div class="mini" id="bucketCount">0 Posten</div>
            </div>
            <div class="sum" id="bucketTotal">0,00 â‚¬</div>
          </div>
        </div>
      </aside>

      <!-- MIDDLE: Categories & Sammelkorb -->
      <section class="card">
        <div class="cardHead">
          <h2>Kategorien & Sammelkorb</h2>
          <div class="controls">
            <div class="search" title="Filter nach Kategorie / HÃ¤ndler / Notiz">
              <span style="opacity:.7">ðŸ”Ž</span>
              <input id="q" placeholder="Filterâ€¦ (z.B. Urlaub, Amazon, Lidl, Tanken)" />
            </div>
            <label class="pill" title="Nur Top-Kategorien anzeigen">
              <input type="checkbox" id="topOnly" />
              <span>Top-8</span>
            </label>
            <button class="btn" id="expandAll">Alle Ã¶ffnen</button>
            <button class="btn" id="collapseAll">Alle schlieÃŸen</button>
          </div>
        </div>

        <div class="cardBody">
          <!-- KPIs -->
          <div class="kpiRow" id="kpis"></div>

          <div class="hr"></div>

          <div class="list" id="list"></div>

          <div class="foot">
            Hinweis: Amazon "zusammen belastet" siehst du als Einzelposten im Amazon-Block, obwohl es im Karten-Auszug ggf. eine Sammelbuchung war.
          </div>
        </div>
      </section>

      <!-- RIGHT -->
      <aside class="rightStack">
        <section class="card">
          <div class="cardHead">
            <h2>Verteilung</h2>
            <div class="mini" id="chartHint"></div>
          </div>
          <div class="cardBody">
            <canvas id="donut" width="520" height="520" aria-label="Ausgaben-Verteilung (Donut Chart)"></canvas>
            <div class="legend" id="legend"></div>
          </div>
        </section>
      </aside>
    </div>
  </div>

  <div class="toast" id="toast">Kopiert âœ…</div>

  <script>
    // === Data ================================================================
    const report = {
  "currency": "EUR",
  "totalExpenses": 6039.2,
  "categories": [
    {
      "name": "Wohnen & MÃ¶bel",
      "total": 1327.03,
      "note": "9 Posten",
      "entries": [
        [
          "HFB ECO IKEA 492 WUPPE (15.12)",
          259.0
        ],
        [
          "HFB ECO IKEA 492 WUPPE (23.12)",
          233.0
        ],
        [
          "PAYPAL *LUKMEBEL (01.12)",
          222.13
        ],
        [
          "Skandic GmbH (01.12)",
          203.04
        ],
        [
          "SP MOTEL A MIIO (01.12)",
          166.74
        ],
        [
          "PAYPAL *WIGIWAMA WIGIW (02.12)",
          138.0
        ],
        [
          "HFB ECO IKEA 492 WUPPE (04.12)",
          70.74
        ],
        [
          "IF IKEA 492 WUPPERTAL (04.12)",
          20.4
        ],
        [
          "HFB ECO IKEA 492 WUPPE (23.12)",
          13.98
        ]
      ]
    },
    {
      "name": "Urlaub",
      "total": 1268.19,
      "note": "16 Posten",
      "entries": [
        [
          "AIRBNB * HMASNNMYM9 (19.12)",
          916.62
        ],
        [
          "B&B Hotels Germany (29.12)",
          103.63
        ],
        [
          "KAUFLAND FREIBURG 4253 (29.12)",
          67.97
        ],
        [
          "SumUp  *Breisgauer fla (29.12)",
          50.0
        ],
        [
          "_BAZG VIA WebShop (29.12)",
          43.08
        ],
        [
          "SumUp  *Uluwatu SNC (29.12)",
          22.51
        ],
        [
          "SAS SAS PASSY DIS (29.12)",
          21.44
        ],
        [
          "DOCY (29.12)",
          7.92
        ],
        [
          "CMNE DE CHAMONIX MONT (30.12)",
          7.5
        ],
        [
          "REVES D'HIVER (30.12)",
          7.0
        ],
        [
          "MAIRIE DE PASSY (30.12)",
          6.0
        ],
        [
          "ATMB (29.12)",
          4.8
        ],
        [
          "CHAMONIX SUPERET (30.12)",
          3.79
        ],
        [
          "SAS SAS PASSY DIS (29.12)",
          2.68
        ],
        [
          "ATMB (29.12)",
          2.2
        ],
        [
          "KORKE (30.12)",
          1.05
        ]
      ]
    },
    {
      "name": "Medien & Elektronik",
      "total": 944.0,
      "note": "1 Posten",
      "entries": [
        [
          "MEDIA MARKT (09.12)",
          944.0
        ]
      ]
    },
    {
      "name": "Shopping",
      "total": 934.15,
      "note": "26 Posten",
      "entries": [
        [
          "Amazon: TURBBO M43 Campfire Feuerset / Outdoor Kochset (15.12)",
          129.99
        ],
        [
          "Amazon: WMF Perfect Cuisine Plus Topfset Induktion (5-teilig) (19.12)",
          117.56
        ],
        [
          "Rockers Bikeshop Duisb (05.12)",
          99.95
        ],
        [
          "Amazon: Barbecue A-Ãœbergitter B â€“ fÃ¼r Dampfergrill (Extra groÃŸer MetallstÃ¤nder) (03.12)",
          98.99
        ],
        [
          "DECAT (29.12)",
          62.95
        ],
        [
          "Amazon: Unbekannt (38.80 â‚¬) (08.12)",
          38.8
        ],
        [
          "Amazon: iClever Kinder-Bluetooth-KopfhÃ¶rer + Brennenstuhl Rauchmelder-Set (29.12)",
          37.34
        ],
        [
          "Etsy.com*unserGLUECK (04.12)",
          36.55
        ],
        [
          "Amazon: Unbekannt (36.20 â‚¬) (03.12)",
          36.2
        ],
        [
          "HM.COM (08.12)",
          32.96
        ],
        [
          "Amazon: Kindsgut WC-Sitz (aquamarin) (01.12)",
          29.71
        ],
        [
          "Amazon: Beurer IL 11 Infrarotlampe (09.12)",
          27.89
        ],
        [
          "aliexpress (09.12)",
          26.84
        ],
        [
          "Amazon: Atmosphera Deckelknubbel/Hobby-Set â€“ BastelzubehÃ¶r (01.12)",
          26.25
        ],
        [
          "Ernsting's family 0000 (11.12)",
          22.48
        ],
        [
          "aliexpress (09.12)",
          20.71
        ],
        [
          "DECATHLON Deutschland (29.12)",
          19.99
        ],
        [
          "Amazon: Crampons Ice Cleats / Schuh-Spikes (Anti-Rutsch) (22.12)",
          18.98
        ],
        [
          "Amazon: TicTocr â€“ Bastelset (Wasser-Marmorierfarbe/Murmel-Farbâ€¦) (04.12)",
          15.0
        ],
        [
          "Amazon: Schmidt Spiele â€“ Bobo SiebenschlÃ¤fer Kinderpuzzle (3Ã—24 Teile) (22.12)",
          8.14
        ],
        [
          "NANU NANA (16.12)",
          7.9
        ],
        [
          "MGP*Vinted (08.12)",
          6.79
        ],
        [
          "Amazon Kindle: The Boyfriend â€“ A Psychological Thriller (English Edition) (29.12)",
          3.83
        ],
        [
          "Amazon Kindle: The Perfect Son (English Edition) (12.12)",
          3.42
        ],
        [
          "Amazon: Pili-BÃ¼cher â€“ â€ž5Ã— Weihnachten bei Julia und Jakobâ€œ (Buch) (03.12)",
          2.5
        ],
        [
          "Etsy.com*DigilyDoo (11.12)",
          2.43
        ]
      ]
    },
    {
      "name": "Lebensmittel & Supermarkt",
      "total": 519.93,
      "note": "27 Posten",
      "entries": [
        [
          "Lidl sagt Danke (08.12)",
          75.62
        ],
        [
          "Lidl sagt Danke (15.12)",
          69.59
        ],
        [
          "Lidl sagt Danke (18.12)",
          58.28
        ],
        [
          "Lidl sagt Danke (22.12)",
          44.98
        ],
        [
          "Michael Bruecken K (09.12)",
          35.25
        ],
        [
          "Lidl sagt Danke (01.12)",
          34.2
        ],
        [
          "ALDI NORD (15.12)",
          31.09
        ],
        [
          "Michael Bruecken K (23.12)",
          19.21
        ],
        [
          "Lidl sagt Danke (11.12)",
          18.15
        ],
        [
          "Michael Bruecken K (19.12)",
          18.13
        ],
        [
          "Michael Bruecken K (03.12)",
          14.7
        ],
        [
          "Michael Bruecken K (04.12)",
          12.6
        ],
        [
          "Michael Bruecken K (01.12)",
          11.54
        ],
        [
          "Michael Bruecken K (08.12)",
          11.35
        ],
        [
          "EDEKA THIEL 717 (01.12)",
          11.04
        ],
        [
          "Michael Bruecken K (10.12)",
          10.24
        ],
        [
          "Michael Bruecken K (15.12)",
          9.94
        ],
        [
          "REWE Essen Porsche (16.12)",
          5.88
        ],
        [
          "Trinkgut Messerich (23.12)",
          5.76
        ],
        [
          "Michael Bruecken K (22.12)",
          4.98
        ],
        [
          "Netto Marken-Discount (22.12)",
          4.48
        ],
        [
          "Edeka Struwe (05.12)",
          4.13
        ],
        [
          "ALDI NORD (04.12)",
          3.95
        ],
        [
          "Michael Bruecken K (09.12)",
          1.99
        ],
        [
          "Michael Bruecken K (05.12)",
          1.29
        ],
        [
          "REWE Hattingen Heggers (29.12)",
          1.27
        ],
        [
          "EDEKA THIEL 717 (11.12)",
          0.29
        ]
      ]
    },
    {
      "name": "Tanken",
      "total": 270.72,
      "note": "7 Posten",
      "entries": [
        [
          "STAR  Velbert (22.12)",
          74.75
        ],
        [
          "STAR  Velbert (08.12)",
          73.62
        ],
        [
          "JET-SB-Tankstelle (29.12)",
          54.83
        ],
        [
          "Aral Tankstelle 201430 (01.12)",
          30.41
        ],
        [
          "HEM Tankstelle (29.12)",
          23.51
        ],
        [
          "HEM Tankstelle (29.12)",
          9.9
        ],
        [
          "Rasthof Tankstelle Hei (29.12)",
          3.7
        ]
      ]
    },
    {
      "name": "Essen & Trinken (auswÃ¤rts)",
      "total": 185.36,
      "note": "20 Posten",
      "entries": [
        [
          "BRASSERIE LE 1904 (30.12)",
          54.28
        ],
        [
          "UZR*Don Camillo e Pepp (02.12)",
          40.0
        ],
        [
          "Boeckels Beste GmbH (12.12)",
          17.7
        ],
        [
          "Policks Backstube GmbH (02.12)",
          12.15
        ],
        [
          "Zettle_*coffee imperfe (12.12)",
          10.5
        ],
        [
          "Backpoint (29.12)",
          7.0
        ],
        [
          "Cafe Hutmacher (19.12)",
          6.8
        ],
        [
          "Policks Backstube GmbH (08.12)",
          5.6
        ],
        [
          "Policks Backstube GmbH (18.12)",
          4.8
        ],
        [
          "BG SARL (30.12)",
          4.5
        ],
        [
          "Rasthaus Renchtal West (29.12)",
          4.23
        ],
        [
          "Cafe Hutmacher (19.12)",
          3.4
        ],
        [
          "Cafe Hutmacher (19.12)",
          3.4
        ],
        [
          "Cafe Hutmacher (19.12)",
          2.7
        ],
        [
          "Policks Backstube GmbH (04.12)",
          1.8
        ],
        [
          "BAECKEREI STEINBRINK (12.12)",
          1.7
        ],
        [
          "PETIT BISCUIT (29.12)",
          1.4
        ],
        [
          "KP Kuellenhahn (22.12)",
          1.2
        ],
        [
          "KP Kuellenhahn (09.12)",
          1.2
        ],
        [
          "Rasthaus Renchtal West (29.12)",
          1.0
        ]
      ]
    },
    {
      "name": "Abos & Digital",
      "total": 162.52,
      "note": "10 Posten",
      "entries": [
        [
          "PAYPAL *ITUNESAPPST AP (01.12)",
          34.95
        ],
        [
          "STARLINK INTERNET (08.12)",
          29.0
        ],
        [
          "OPENAI *CHATGPT SUBSCR (01.12)",
          20.6
        ],
        [
          "OPENAI *CHATGPT SUBSCR (30.12)",
          20.25
        ],
        [
          "APPLE.COM/BILL (08.12)",
          19.99
        ],
        [
          "PAYPAL *SCRIBD.COM 667 (04.12)",
          10.99
        ],
        [
          "NAVIGRAPH (19.12)",
          10.77
        ],
        [
          "PAYPAL *RTLINTERACT BK (10.12)",
          7.99
        ],
        [
          "NETFLIX.COM (29.12)",
          4.99
        ],
        [
          "PAYPAL *ITUNESAPPST AP (04.12)",
          2.99
        ]
      ]
    },
    {
      "name": "DM (Drogerie)",
      "total": 136.05,
      "note": "5 Posten",
      "entries": [
        [
          "DM-Drogerie Markt (08.12)",
          83.02
        ],
        [
          "DM-Drogerie Markt (22.12)",
          41.38
        ],
        [
          "DM Drogerie Markt (29.12)",
          6.35
        ],
        [
          "DM-Drogerie Markt (10.12)",
          3.85
        ],
        [
          "DM Drogerie Markt (29.12)",
          1.45
        ]
      ]
    },
    {
      "name": "PayPal/Transfers",
      "total": 119.97,
      "note": "7 Posten",
      "entries": [
        [
          "PAYPAL *saskia_stoeckl (01.12)",
          41.5
        ],
        [
          "PAYPAL *jessica.breuin (01.12)",
          23.0
        ],
        [
          "PAYPAL *RHEINBAHNAG (17.12)",
          17.9
        ],
        [
          "PAYPAL *THALIA.DE 1413 (23.12)",
          15.0
        ],
        [
          "PAYPAL *THALIA.DE 1410 (05.12)",
          13.0
        ],
        [
          "PAYPAL *RHEINBAHNAG (15.12)",
          7.2
        ],
        [
          "PAYPAL *GETSAFEDIGI (29.12)",
          2.37
        ]
      ]
    },
    {
      "name": "Gesundheit",
      "total": 96.04,
      "note": "6 Posten",
      "entries": [
        [
          "Nord Apotheke Wupperta (11.12)",
          53.95
        ],
        [
          "Burg-Apotheke Apotheke (10.12)",
          20.69
        ],
        [
          "Hahnerberg-Apotheke (03.12)",
          6.25
        ],
        [
          "APOTHEKE IM SIEPEN ARA (03.12)",
          5.95
        ],
        [
          "Hahnerberg-Apotheke (09.12)",
          5.45
        ],
        [
          "SPC*Hahnerb. Apotheke (22.12)",
          3.75
        ]
      ]
    },
    {
      "name": "Freizeit & Kultur",
      "total": 20.0,
      "note": "1 Posten",
      "entries": [
        [
          "kinotickets.online (18.12)",
          20.0
        ]
      ]
    },
    {
      "name": "Ã–PNV/Parken",
      "total": 19.0,
      "note": "4 Posten",
      "entries": [
        [
          "BVGProd (05.12)",
          7.9
        ],
        [
          "Q PARK RATHAUS GALERIE (16.12)",
          5.1
        ],
        [
          "ParkDepot GmbH (29.12)",
          3.0
        ],
        [
          "PARKEN Wuppertal Neuma (10.12)",
          3.0
        ]
      ]
    },
    {
      "name": "Baumarkt & DIY",
      "total": 15.32,
      "note": "1 Posten",
      "entries": [
        [
          "OBI SAGT DANKE (22.12)",
          15.32
        ]
      ]
    },
    {
      "name": "GebÃ¼hren",
      "total": 14.49,
      "note": "7 Posten",
      "entries": [
        [
          "monatlicher Kartenpreis (23.12)",
          11.5
        ],
        [
          "1,95% fÃ¼r WÃ¤hrungsumrechn (29.12)",
          0.84
        ],
        [
          "1,95% fÃ¼r WÃ¤hrungsumrechn (09.12)",
          0.52
        ],
        [
          "1,95% fÃ¼r WÃ¤hrungsumrechn (29.12)",
          0.44
        ],
        [
          "1,95% fÃ¼r WÃ¤hrungsumrechn (09.12)",
          0.4
        ],
        [
          "1,95% fÃ¼r WÃ¤hrungsumrechn (01.12)",
          0.4
        ],
        [
          "1,95% fÃ¼r WÃ¤hrungsumrechn (30.12)",
          0.39
        ]
      ]
    },
    {
      "name": "Drogerie (sonstige)",
      "total": 6.43,
      "note": "2 Posten",
      "entries": [
        [
          "Rossmann 1625 (11.12)",
          5.39
        ],
        [
          "Rossmann 3555 (16.12)",
          1.04
        ]
      ]
    }
  ]
};

    // === Helpers =============================================================
    const fmt = (n) => new Intl.NumberFormat("de-DE", { style:"currency", currency: report.currency }).format(n);
    const clamp = (x, a, b) => Math.max(a, Math.min(b, x));

    function escapeHtml(s){
      return String(s).replace(/[&<>"']/g, m => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
      }[m]));
    }
    function escapeAttr(s){ return escapeHtml(s).replace(/"/g, "&quot;"); }

    function toast(msg="Kopiert âœ…"){
      const el = document.getElementById("toast");
      el.textContent = msg;
      el.style.display = "block";
      clearTimeout(toast._t);
      toast._t = setTimeout(()=> el.style.display="none", 1300);
    }

    // === Derived =============================================================
    const categoriesSorted = [...report.categories].sort((a,b)=> b.total - a.total);
    const total = report.totalExpenses;

    // === Header badges =======================================================
    const badgeRow = document.getElementById("badgeRow");
    const vacation = report.categories.find(c => c.name.startsWith("Urlaub"));
    const vacationPct = (vacation.total / total) * 100;

    const badges = [
      { label: "Gesamtausgaben", value: fmt(total) },
      { label: "Kategorien", value: String(report.categories.length) },
      { label: "Urlaub", value: `${fmt(vacation.total)} (${vacationPct.toFixed(1)}%)` },
    ];
    badgeRow.innerHTML = badges.map(b =>
      `<div class="badge"><span>${b.label}: </span><strong>${b.value}</strong></div>`
    ).join("");

    // === KPIs ================================================================
    const kpis = document.getElementById("kpis");
    const top3 = categoriesSorted.slice(0,3);
    const top3sum = top3.reduce((s,c)=> s+c.total, 0);
    const rest = total - top3sum;

    const kpiData = [
      { label: "Top-3 zusammen", value: fmt(top3sum), hint: `${(top3sum/total*100).toFixed(1)}% der Ausgaben` },
      { label: "Urlaub-Anteil", value: fmt(vacation.total), hint: `${vacationPct.toFixed(1)}% der Ausgaben` },
      { label: "Rest", value: fmt(rest), hint: `${(rest/total*100).toFixed(1)}% verteilt` },
    ];
    kpis.innerHTML = kpiData.map(k => `
      <div class="kpi">
        <div class="label">${k.label}</div>
        <div class="value">${k.value}</div>
        <div class="hint">${k.hint}</div>
      </div>
    `).join("");

    // === Drag & Drop Basket ==================================================
    const dropzone = document.getElementById("dropzone");
    const bucketList = document.getElementById("bucketList");
    const bucketTotalEl = document.getElementById("bucketTotal");
    const bucketCountEl = document.getElementById("bucketCount");
    const dropHint = document.getElementById("dropHint");

    const basket = []; // {id,label,amount,category}

    function updateBasketUI(){
      const sum = basket.reduce((s,x)=> s + x.amount, 0);
      bucketTotalEl.textContent = fmt(sum);
      bucketCountEl.textContent = `${basket.length} Posten`;
      dropHint.style.display = basket.length ? "none" : "block";

      bucketList.innerHTML = basket.map((x) => `
        <div class="basketItem" data-id="${escapeAttr(x.id)}">
          <div style="min-width:0">
            <div class="name">${escapeHtml(x.label)}</div>
            <div class="meta">${escapeHtml(x.category)}</div>
          </div>
          <div class="right">
            <div class="val">${fmt(x.amount)}</div>
            <button class="xbtn" title="Entfernen" aria-label="Entfernen">Ã—</button>
          </div>
        </div>
      `).join("");

      bucketList.querySelectorAll(".basketItem .xbtn").forEach(btn=>{
        btn.addEventListener("click", (e)=>{
          const item = e.target.closest(".basketItem");
          const id = item.getAttribute("data-id");
          const idx = basket.findIndex(b => b.id === id);
          if (idx >= 0) basket.splice(idx, 1);
          updateBasketUI();
        });
      });
    }

    function addToBasket(payload){
      basket.push({
        id: (crypto.randomUUID ? crypto.randomUUID() : String(Date.now()) + Math.random()),
        label: payload.label,
        amount: payload.amount,
        category: payload.category
      });
      updateBasketUI();
    }

    function setOver(on){ dropzone.classList.toggle("isOver", !!on); }

    dropzone.addEventListener("dragover", (e)=>{ e.preventDefault(); setOver(true); });
    dropzone.addEventListener("dragleave", ()=> setOver(false));
    dropzone.addEventListener("drop", (e)=>{
      e.preventDefault();
      setOver(false);
      const raw = e.dataTransfer.getData("application/json");
      if(!raw) return;
      try{
        const payload = JSON.parse(raw);
        if(typeof payload.amount !== "number" || !payload.label) return;
        addToBasket(payload);
      }catch(_){}
    });

    document.getElementById("clearBasket").addEventListener("click", ()=>{
      basket.length = 0;
      updateBasketUI();
    });

    document.getElementById("copyBasket").addEventListener("click", async ()=>{
      const sum = basket.reduce((s,x)=> s + x.amount, 0);
      const text =
        `Sammelkorb (${basket.length} Posten) â€“ Summe: ${fmt(sum)}\n` +
        basket.map(x => `- ${x.category}: ${x.label} (${fmt(x.amount)})`).join("\n");
      try{
        await navigator.clipboard.writeText(text);
        toast("Sammelkorb kopiert âœ…");
      }catch(e){
        toast("Kopieren nicht mÃ¶glich");
      }
    });

    updateBasketUI();

    // === Categories ==========================================================
    const listEl = document.getElementById("list");
    const qEl = document.getElementById("q");
    const topOnlyEl = document.getElementById("topOnly");

    function renderList(){
      const q = (qEl.value || "").trim().toLowerCase();
      let data = [...categoriesSorted];

      if (topOnlyEl.checked) data = data.slice(0,8);

      if (q){
        data = data.filter(c =>
          c.name.toLowerCase().includes(q) ||
          (c.note || "").toLowerCase().includes(q) ||
          (c.entries || []).some(([k]) => String(k).toLowerCase().includes(q))
        );
      }

      const max = Math.max(...data.map(d => d.total), 1);

      listEl.innerHTML = data.map((c, idx) => {
        const pct = (c.total/total)*100;
        const barW = clamp((c.total/max)*100, 0, 100);
        const id = `cat_${idx}_${c.name.replace(/\W+/g,'_')}`;
        const entries = c.entries || [];
        const meta = `${pct.toFixed(1)}%`;

        const entryRows = entries.map(([label, amount]) => {
          const payload = { label, amount: Number(amount), category: c.name };
          const json = escapeAttr(JSON.stringify(payload));
          return `
            <div class="entry" draggable="true" data-json="${json}">
              <div class="left">
                <div class="handle" title="Drag">â ¿</div>
                <div class="txt">
                  <div class="label">${escapeHtml(label)}</div>
                </div>
              </div>
              <div class="val">${fmt(amount)}</div>
            </div>
          `;
        }).join("");

        const detailHtml = `
          <div class="details" id="${id}_d">
            <div>
              <strong style="color:rgba(233,236,247,.92)">Einzelposten</strong>
              <span style="font-family:var(--mono)">(${entries.length})</span>
              <span class="mini" style="margin-left:8px">â†’ Drag & Drop mÃ¶glich</span>
            </div>
            ${entries.length ? `<div class="entryList">${entryRows}</div>` : `<div style="margin-top:8px">Keine Einzelposten hinterlegt.</div>`}
          </div>
        `;

        return `
          <div class="item" data-open="0">
            <div class="itemTop" id="${id}">
              <div class="itemName">
                <div class="name">${escapeHtml(c.name)}</div>
                <div class="meta">${escapeHtml(meta)}</div>
              </div>
              <div class="amount">${fmt(c.total)}</div>
            </div>
            <div class="bar"><div style="width:${barW.toFixed(1)}%"></div></div>
            ${detailHtml}
          </div>
        `;
      }).join("");

      // toggle + bind dnd
      document.querySelectorAll(".itemTop").forEach(top => {
        top.addEventListener("click", () => {
          const item = top.closest(".item");
          const d = item.querySelector(".details");
          const open = item.getAttribute("data-open") === "1";
          item.setAttribute("data-open", open ? "0" : "1");
          d.style.display = open ? "none" : "block";
          if(!open) attachEntryDnD(d);
        });
      });

      // If already open somehow
      document.querySelectorAll(".details").forEach(attachEntryDnD);
    }

    function attachEntryDnD(container){
      if(!container) return;
      container.querySelectorAll(".entry[draggable='true']").forEach(el=>{
        if(el.dataset.bound === "1") return;
        el.dataset.bound = "1";
        el.addEventListener("dragstart", (e)=>{
          const raw = el.getAttribute("data-json");
          if(!raw) return;
          e.dataTransfer.setData("application/json", raw);
          e.dataTransfer.effectAllowed = "copy";
        });
      });
    }

    qEl.addEventListener("input", renderList);
    topOnlyEl.addEventListener("change", renderList);

    document.getElementById("expandAll").addEventListener("click", () => {
      document.querySelectorAll(".item").forEach(item => {
        item.setAttribute("data-open","1");
        const d = item.querySelector(".details");
        d.style.display = "block";
        attachEntryDnD(d);
      });
    });
    document.getElementById("collapseAll").addEventListener("click", () => {
      document.querySelectorAll(".item").forEach(item => {
        item.setAttribute("data-open","0");
        item.querySelector(".details").style.display = "none";
      });
    });

    renderList();

    // === Donut chart =========================================================
    const canvas = document.getElementById("donut");
    const ctx = canvas.getContext("2d");

    // Better color palette with more distinct colors
    const colorPalette = [
      { h: 280, s: 75, l: 60 },  // Purple
      { h: 340, s: 80, l: 55 },  // Pink/Red
      { h: 25, s: 85, l: 55 },   // Orange
      { h: 50, s: 90, l: 50 },   // Yellow
      { h: 160, s: 70, l: 45 },  // Teal
      { h: 210, s: 75, l: 55 },  // Blue
      { h: 120, s: 60, l: 45 },  // Green
      { h: 190, s: 70, l: 50 },  // Cyan
      { h: 0, s: 70, l: 55 },    // Red
      { h: 260, s: 65, l: 60 },  // Violet
    ];

    let chartSegments = [];
    let hoveredSegment = null;

    function drawDonut(){
      const W = canvas.width, H = canvas.height;
      const cx = W/2, cy = H/2;
      const rOuter = Math.min(W,H) * 0.40;
      const rInner = rOuter * 0.62;

      ctx.clearRect(0,0,W,H);

      // background ring
      ctx.beginPath();
      ctx.arc(cx,cy,rOuter,0,Math.PI*2);
      ctx.arc(cx,cy,rInner,0,Math.PI*2,true);
      ctx.closePath();
      ctx.fillStyle = "rgba(255,255,255,.05)";
      ctx.fill();

      const data = categoriesSorted.slice(0,9);
      const other = total - data.reduce((s,c)=> s+c.total, 0);
      const chartData = other > 0.01 ? [...data, {name:"Rest (weitere)", total: other}] : data;

      chartSegments = [];
      let start = -Math.PI/2;

      chartData.forEach((c, i) => {
        const angle = (c.total/total) * Math.PI*2;
        const color = colorPalette[i % colorPalette.length];
        const isHovered = hoveredSegment === i;

        // Use solid color instead of gradient
        const brightness = isHovered ? 1.15 : 1;
        ctx.fillStyle = `hsla(${color.h}, ${color.s}%, ${color.l * brightness}%, .95)`;

        // Draw segment
        const outerRadius = isHovered ? rOuter + 5 : rOuter;
        ctx.beginPath();
        ctx.moveTo(cx,cy);
        ctx.arc(cx,cy,outerRadius,start,start+angle);
        ctx.closePath();
        ctx.fill();

        // Store segment info for hit detection
        chartSegments.push({
          startAngle: start,
          endAngle: start + angle,
          name: c.name,
          amount: c.total,
          color: color,
          index: i
        });

        // punch inner hole
        ctx.globalCompositeOperation = "destination-out";
        ctx.beginPath();
        ctx.arc(cx,cy,rInner,0,Math.PI*2);
        ctx.fill();
        ctx.globalCompositeOperation = "source-over";

        start += angle;
      });

      // center label
      ctx.fillStyle = "rgba(233,236,247,.95)";
      ctx.font = "800 32px " + getComputedStyle(document.body).fontFamily;
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";
      
      if (hoveredSegment !== null && chartSegments[hoveredSegment]) {
        const seg = chartSegments[hoveredSegment];
        ctx.font = "700 18px " + getComputedStyle(document.body).fontFamily;
        ctx.fillText(seg.name, cx, cy - 15);
        ctx.font = "800 24px " + getComputedStyle(document.body).fontFamily;
        ctx.fillText(fmt(seg.amount), cx, cy + 15);
      } else {
        ctx.fillText(fmt(total), cx, cy - 10);
        ctx.fillStyle = "rgba(233,236,247,.65)";
        ctx.font = "600 14px " + getComputedStyle(document.body).fontFamily;
        ctx.fillText("Gesamtausgaben", cx, cy + 22);
      }

      // legend
      const legend = document.getElementById("legend");
      legend.innerHTML = chartData.slice(0,8).map((c,i)=> {
        const color = colorPalette[i % colorPalette.length];
        return `<div class="leg">
          <span class="dot" style="background: hsl(${color.h}, ${color.s}%, ${color.l}%)"></span>
          <span>${escapeHtml(c.name)}</span>
          <span style="margin-left:6px;font-family:var(--mono)">${(c.total/total*100).toFixed(1)}%</span>
        </div>`;
      }).join("");

      document.getElementById("chartHint").textContent =
        `Chart zeigt Top-${Math.min(9, categoriesSorted.length)} + Rest`;
    }

    // Mouse interaction
    canvas.addEventListener('mousemove', (e) => {
      const rect = canvas.getBoundingClientRect();
      const scaleX = canvas.width / rect.width;
      const scaleY = canvas.height / rect.height;
      const x = (e.clientX - rect.left) * scaleX;
      const y = (e.clientY - rect.top) * scaleY;

      const cx = canvas.width / 2;
      const cy = canvas.height / 2;
      const dx = x - cx;
      const dy = y - cy;
      const distance = Math.sqrt(dx * dx + dy * dy);
      const rOuter = Math.min(canvas.width, canvas.height) * 0.40;
      const rInner = rOuter * 0.62;

      // Check if mouse is in the ring
      if (distance >= rInner && distance <= rOuter + 10) {
        // Calculate angle from center (0 = right, increases counter-clockwise)
        let angle = Math.atan2(dy, dx);
        // Normalize to 0-2Ï€ range
        if (angle < 0) angle += Math.PI * 2;

        let foundSegment = null;
        chartSegments.forEach((seg, i) => {
          let start = seg.startAngle;
          let end = seg.endAngle;
          
          // Normalize segment angles to 0-2Ï€ range
          while (start < 0) start += Math.PI * 2;
          while (end < 0) end += Math.PI * 2;
          while (start >= Math.PI * 2) start -= Math.PI * 2;
          while (end >= Math.PI * 2) end -= Math.PI * 2;

          // Check if angle is within segment
          if (start <= end) {
            // Normal case: segment doesn't wrap around
            if (angle >= start && angle <= end) {
              foundSegment = i;
            }
          } else {
            // Segment wraps around 0/2Ï€
            if (angle >= start || angle <= end) {
              foundSegment = i;
            }
          }
        });

        if (foundSegment !== hoveredSegment) {
          hoveredSegment = foundSegment;
          canvas.style.cursor = foundSegment !== null ? 'pointer' : 'default';
          drawDonut();
        }
      } else {
        if (hoveredSegment !== null) {
          hoveredSegment = null;
          canvas.style.cursor = 'default';
          drawDonut();
        }
      }
    });

    canvas.addEventListener('mouseleave', () => {
      if (hoveredSegment !== null) {
        hoveredSegment = null;
        canvas.style.cursor = 'default';
        drawDonut();
      }
    });

    drawDonut();
  </script>
</body>
</html>
